import{_ as R}from"./keyIcon-59861900.js";import{u as D,i as H,s as $,v as u,c as j,L as G,j as J,r as f,o as y,a as _,w,d as C,P as N,b as x,e as r,t as T,m as q,q as z,x as E,n as A,z as W}from"./index-ffa3455d.js";const Y=r("div",null,[r("img",{src:R,alt:"",class:"mx-auto"})],-1),K={class:"ion-padding mb-2 flex flex-col gap-4"},Q={class:"text-center text-2xl font-semibold text-primary"},X=r("hr",null,null,-1),se={__name:"ChangePin",setup(Z){const m=D(),p=H(),d=$("http"),{showToast:P,processError:b}=W,a=u("old"),s=u(!1),c=u(!1),n=u(!1),o=j(()=>m.getUser),h=u(""),l=u(""),i=G({oldPin:"",pin:"",confirmPin:""}),k=async()=>{const{value:e}=await N.get({key:"fromHome"});h.value=JSON.parse(e)};k(),J(async()=>{await k(),h.value?l.value="Create Your Pin":l.value=o.value&&o.value.isPinSet?"Enter Old Pin":"Enter Pin",a.value=o.value&&o.value.isPinSet?"old":"new"});const I=async e=>{if(c.value=!1,e.length==6){if(n.value=!1,a.value=="old")return M(e),!1;if(a.value=="new")return l.value="Confirm Pin",i.pin=e,c.value=!0,a.value="confirm",!1;if(a.value=="confirm"&&i.pin!==e)return n.value="Pin doesn't match",!1;V()}},S=()=>{a.value==="old"?p.go(-1):a.value=="new"?(a.value="old",l.value="Enter Old Pin"):a.value=="confirm"&&(a.value="new",l.value="Enter New Pin")},V=async e=>{c.value=!1,s.value=!0;const t={oldPin:i.oldPin,pin:i.pin};o.value&&!o.value.isPinSet&&delete t.oldPin;try{await d({endpoint:"UpdatePin",httpMethod:"patch",body:t}),s.value=!1,P("success","Pin updated successful"),c.value=!1,U(),h.value=="true"?(await N.set({key:"fromHome",value:"false"}),p.push({name:"Home"})):p.push({name:"AccountSettings"})}catch(v){s.value=!1;const g=JSON.stringify(v.response.data.message[0]);n.value=g}},M=async e=>{try{s.value=!0;const t=await d({endpoint:"VerifyPin",httpMethod:"post",body:{pin:e}});console.log(t),s.value=!1,t.isPinValid?(l.value="Enter New Pin",i.oldPin=e,a.value="new",c.value=!0):n.value="Pin is incorrect"}catch(t){n.value="Pin is incorrect",s.value=!1;const v=b(t);n.value=v}},O=async()=>{try{s.value=!0;const e=await d({endpoint:"SendOtp",httpMethod:"post",body:{userEmailOrPhone:o.value.email}});s.value=!1,p.push({name:"ResetPin"})}catch(e){s.value=!1;const t=e.response.data.message;console.log(t),P("error",t)}},U=async()=>{try{const e=await d({endpoint:"GetUser",httpMethod:"get"});console.log(e),m.$patch({user:e}),B(e)}catch(e){const t=b(e);P("error",t),console.log(t)}},B=async e=>{try{const t=await d({endpoint:"GetUserLocation",httpMethod:"get",body:i});e.location=t,m.$patch({user:e}),console.log(e)}catch(t){console.log(t)}};return(e,t)=>{const v=f("PNav"),g=f("PInputpin"),F=f("PFooter"),L=f("PLoader");return y(),_(C(A),null,{default:w(()=>[x(v,{onClick:S}),x(C(q),{fullscreen:!0},{default:w(()=>[Y,r("div",K,[r("h3",Q,T(l.value),1),x(g,{error:n.value,onResetError:t[0]||(t[0]=ee=>n.value=!1),onInput:I,clearInput:c.value},null,8,["error","clearInput"])])]),_:1}),a.value=="old"?(y(),_(F,{key:0,class:"bg-white"},{default:w(()=>[X,r("p",{class:"mt-6 pb-8 text-center text-sm text-dark-400"},[z(" Can't remember pin? "),r("span",{onClick:O,class:"font-medium text-secondary"},"Reset")])]),_:1})):E("",!0),s.value?(y(),_(L,{key:1})):E("",!0)]),_:1})}}};export{se as default};
