import{u as U,s as W,v as p,c as V,M as z,r as f,o as m,h as I,b as l,w as i,e as a,d as h,F,y as G,a as q,q as x,x as E,z as R,k as H,l as K,H as Y,m as D,n as J}from"./index-ffa3455d.js";import{_ as j}from"./CreditCard-f0860296.js";import{S as Q,a as X,A as Z,K as ee,N as te,b as oe}from"./swiper-slide-dd9ef5d1.js";import"./fade-fff22378.js";const se="/assets/autoBill-61953b48.svg",le={class:"grid grid-cols-1 gap-4 px-2 py-4"},ae=a("h3",{class:"text-2xl font-semibold text-primary"},"Select billing method",-1),ne=a("i",{class:"pi pi-plus"},null,-1),ie={class:"grid grid-cols-2 gap-2"},ce={__name:"SetAutoBilling",props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(L,{emit:g}){const{openBrowser:A,showToast:b,processError:S}=R,c=U(),r=W("http"),$=[Z,ee,te,oe],v=p(),_=e=>{v.value=e},B=e=>{console.log(e.activeIndex),C.value=e.activeIndex},u=p(!1);p("amount"),p(""),p(!1);const C=p(0),y=V(()=>{const e=[...c.getCards],s={...c.getWallet};s.method="wallet",e.forEach(w=>{w.method="card"});let d=[s,...e];return d=d.sort((w,M)=>M.use_for_auto_renew-w.use_for_auto_renew),d});z(()=>{});const k=V(()=>{if(y.value.length)return y.value.find((e,s)=>s===C.value)}),P=()=>{C.value=0,g("close")},N=async()=>{try{u.value=!0,console.log(k.value);const e=k&&k.value.method=="wallet"?"wallet":k.value.id,s=await r({endpoint:"UpdateAutoBilling",httpMethod:"patch",body:{channel:e}});console.log(s),b("success","Auto Billing successfully set"),g("close"),await O(),await o(),await t(),u.value=!1}catch(e){u.value=!1;const s=S(e);console.log(s),b("error",s)}},O=async()=>{try{const e=await r({endpoint:"AutoBillingStatus",httpMethod:"get"});console.log(e),c.$patch({autoBillingStatus:e.isAutoBillingActivated})}catch(e){const s=S(e);console.log(s)}},o=async()=>{try{const e=await r({endpoint:"MyWallet",httpMethod:"get"});console.log(e),c.$patch({wallet:e})}catch(e){const s=S(e);console.log(s)}},t=async()=>{try{const e=await r({endpoint:"GetCards",httpMethod:"get"});console.log(e),c.$patch({cards:e.items})}catch(e){const s=S(e);console.log(s)}};return(e,s)=>{const d=f("PButton"),w=f("PModal"),M=f("PLoader");return m(),I(F,null,[l(w,{type:"sheet",noHeader:"",initialBreakpoint:1,persistence:"",height:"h-[350px]",breakpoints:[0,1],isOpen:L.isOpen,onClose:P},{default:i(()=>[a("div",le,[ae,a("div",null,[l(h(Q),{modules:$,autoplay:!1,zoom:!0,"space-between":20,slidesPerView:y.value&&y.value.length>1?1.1:1,onSwiper:_,onSlideChange:B,class:""},{default:i(()=>[(m(!0),I(F,null,G(y.value,(n,T)=>(m(),q(h(X),{class:"",key:T},{default:i(()=>[l(j,{method:n.method,card:n,color:C.value==T?"secondary":"dark-100",outlined:""},null,8,["method","card","color"])]),_:2},1024))),128))]),_:1},8,["slidesPerView"])]),a("div",null,[a("span",{onClick:s[0]||(s[0]=n=>(e.$emit("close"),e.$router.push({name:"Cards"}))),class:"flex cursor-pointer items-center gap-1 text-sm text-secondary"},[ne,x(" Use a different card ")])]),a("div",ie,[l(d,{block:"",fill:"outline",onClick:P},{default:i(()=>[x("Cancel")]),_:1}),l(d,{loading:u.value,block:"",onClick:N},{default:i(()=>[x("Continue")]),_:1},8,["loading"])])])]),_:1},8,["isOpen"]),u.value?(m(),q(M,{key:0})):E("",!0)],64)}}},re={class:"grid grid-cols-1 gap-4"},ue={class:"grid grid-cols-1 gap-3 px-4"},de={class:"flex items-center justify-between gap-4"},pe=a("h3",{class:"text-2xl font-semibold text-primary"},"Auto Billing",-1),ge=a("p",{class:"text-sm text-dark-400"}," Never miss a payment or subscription renewal again - let us handle it with our convenient automatic billing option ",-1),me={key:0,class:"ion-padding grid grid-cols-1 gap-2"},he={key:0},fe={key:1},ve={class:"grid grid-cols-2 gap-2"},Ce={__name:"AutoBilling",setup(L){const g=U(),A=W("http"),{showToast:b,formatAmount:S,processError:c}=R,r=p(!1),$=p(!1),v=p(!1),_=p(!1),B=V(()=>g.getAutoBillingStatus),u=V(()=>{const o=[...g.getCards],t={...g.getWallet};return t.method="wallet",o.forEach(s=>{s.method="card"}),[t,...o].find(s=>s.use_for_auto_renew==!0)});console.log("dafadfadad",u.value);const C=async o=>{await P(),await N(),await O(),o.target.complete()},y=()=>{B.value?r.value=!0:v.value=!0},k=async()=>{try{$.value=!0;const o=await A({endpoint:"UpdateAutoBilling",httpMethod:"patch",body:{channel:null}});console.log(o),$.value=!1,r.value=!1,_.value=!0,await P(),b("success","Auto Billing successfully updated"),_.value=!1,await N(),await O()}catch(o){_.value=!1;const t=c(o);console.log(t),b("error",t)}},P=async()=>{try{const o=await A({endpoint:"AutoBillingStatus",httpMethod:"get"});console.log(o),g.$patch({autoBillingStatus:o.isAutoBillingActivated})}catch(o){const t=c(o);console.log(t)}},N=async()=>{try{const o=await A({endpoint:"MyWallet",httpMethod:"get"});console.log(o),g.$patch({wallet:o})}catch(o){const t=c(o);console.log(t)}},O=async()=>{try{const o=await A({endpoint:"GetCards",httpMethod:"get"});console.log(o),g.$patch({cards:o.items})}catch(o){const t=c(o);console.log(t)}};return(o,t)=>{const e=f("PNav"),s=f("PEmpty"),d=f("PButton"),w=f("PAlert"),M=f("PLoader");return m(),q(h(J),null,{default:i(()=>[l(e),l(h(D),{fullscreen:""},{default:i(()=>[l(h(H),{slot:"fixed",onIonRefresh:t[0]||(t[0]=n=>C(n))},{default:i(()=>[l(h(K))]),_:1}),a("div",re,[a("div",ue,[a("div",de,[pe,a("div",{class:"",onClick:y},[l(h(Y),{modelValue:B.value,"onUpdate:modelValue":t[1]||(t[1]=n=>B.value=n),class:"pointer-events-none",mode:"ios",slot:"end",color:"secondary"},null,8,["modelValue"])])]),ge]),B.value?(m(),I("div",me,[u.value?(m(),I("div",he,[l(j,{method:u.value.method,card:u.value,outlined:""},null,8,["method","card"])])):E("",!0),a("div",null,[a("span",{onClick:t[2]||(t[2]=n=>v.value=!0),class:"cursor-pointer text-sm text-secondary"},"Change payment method")])])):(m(),I("div",fe,[l(s,{icon:h(se),title:"Auto Billing not set"},null,8,["icon"]),l(d,{onClick:t[3]||(t[3]=n=>v.value=!0),loading:_.value,block:"",class:"mx-4"},{default:i(()=>[x("Set Auto Billing")]),_:1},8,["loading"])]))])]),_:1}),l(ce,{isOpen:v.value,onClose:t[4]||(t[4]=n=>v.value=!1)},null,8,["isOpen"]),l(w,{type:"info",isOpen:r.value,onClose:t[6]||(t[6]=n=>r.value=!1),title:"Off Auto Billing",caption:"You are about to turn off auto billing"},{default:i(()=>[a("div",ve,[l(d,{onClick:t[5]||(t[5]=n=>r.value=!1),block:""},{default:i(()=>[x(" Cancel")]),_:1}),l(d,{loading:$.value,fill:"outline",onClick:k,block:""},{default:i(()=>[x(" Yes")]),_:1},8,["loading"])])]),_:1},8,["isOpen"]),_.value?(m(),q(M,{key:0})):E("",!0)]),_:1})}}};export{Ce as default};
