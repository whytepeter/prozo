import{u as B,s as F,i as I,v as w,L as _,r as c,o as E,a as R,w as l,d as h,b as a,e as r,q as y,m as S,n as U,P as v,z as A}from"./index-ffa3455d.js";const D={class:"grid grid-cols-1 gap-2 px-4"},M=r("h3",{class:"text-2xl font-semibold text-primary"},"Login",-1),T={class:"text-sm text-dark-400"},q={class:"ion-padding grid grid-cols-1 gap-2"},G=r("span",{class:"w-full text-left text-sm"}," Forgot your password? ",-1),j={class:"ion-padding mb-4"},J={__name:"LoginScreen",setup(z){const d=B(),u=F("http"),P=I(),{validateEmail:x,showToast:p,processError:m}=A,i=w(!1),s=_({email:"",password:"",type:"user"}),b=w(""),t=_({email:!1,password:!1});function k(){return s.email.trim()==""?(t.email="Please fill in your email or phone number",!1):x(s.email)?s.password.trim()==""?(t.password="Please enter a password",!1):(t.email=!1,t.password=!1,!0):(t.email="Email is badly formated",!1)}const L=async()=>{if(k()){console.log(s);try{i.value=!0;const e=await u({endpoint:"Login",httpMethod:"post",body:s});console.log(e),await v.set({key:"token",value:e.token}),v.set({key:"firstTimer",value:"false"}),d.$patch({user:e.user,isLoggedIn:!0}),i.value=!1,s.email="",s.password="",P.push({name:"Home"}),N(e.user),V(),p("success","Login Successful")}catch(e){i.value=!1,b.value=JSON.stringify(e);const o=m(e);errorNN.value=o,p("error",o),console.log(o)}}},N=async e=>{try{const o=await u({endpoint:"GetUserLocation",httpMethod:"get"});e.location=o,d.$patch({user:e}),console.log(e)}catch(o){console.log(o)}},V=async()=>{try{const e=await u({endpoint:"GetAllLocation",httpMethod:"get"});d.$patch({locationAreas:e}),console.log(e)}catch(e){const o=m(e);console.log(o)}};return(e,o)=>{const $=c("PNav"),f=c("PInput"),g=c("PButton"),C=c("PFooter");return E(),R(h(U),null,{default:l(()=>[a($),a(h(S),{fullscreen:""},{default:l(()=>[r("div",D,[M,r("p",T,[y(" Don't have an account? "),r("span",{onClick:o[0]||(o[0]=n=>e.$router.push({name:"Register"})),class:"font-medium text-secondary"},"Register")])]),r("form",q,[a(f,{modelValue:s.email,"onUpdate:modelValue":o[1]||(o[1]=n=>s.email=n),label:"Email Address",type:"email",inputmode:"email",error:t.email},null,8,["modelValue","error"]),a(f,{modelValue:s.password,"onUpdate:modelValue":o[2]||(o[2]=n=>s.password=n),label:"Password",type:"password",inputmode:"password",error:t.password},null,8,["modelValue","error"]),a(g,{onClick:o[3]||(o[3]=n=>e.$router.push({name:"ForgotPassword"})),fill:"clear",color:"secondary",class:"-ml-4 -mt-2 w-fit px-0"},{default:l(()=>[G]),_:1})])]),_:1}),a(C,null,{default:l(()=>[r("div",j,[a(g,{onClick:L,block:"",loading:i.value,type:"submit"},{default:l(()=>[y("Login")]),_:1},8,["loading"])])]),_:1})]),_:1})}}};export{J as default};
